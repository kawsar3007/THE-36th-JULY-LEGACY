// --- CONFIGURATION ---
const totalPlots = 2400;
const columns = 60; // ৬০টি কলাম
const rows = 40;    // ৪০টি সারি (৬০ x ৪০ = ২৪০০ প্লট)
const cellSize = 100; // প্রতিটি ব্লকের সাইজ (pixel)
const canvas = document.getElementById('mapCanvas');
const ctx = canvas.getContext('2d');
const marker = document.getElementById('plotMarker');

// ক্যানভাসের সাইজ সেট করা (৬০*১০০ = ৬০০০px চওড়া)
canvas.width = columns * cellSize;
canvas.height = rows * cellSize;

// --- আপনার কাস্টমারদের ডাটাবেজ (উদাহরণ) ---
// যখনই কোনো প্লট বিক্রি হবে, শুধু এখানে ID, Logo এবং Link বসিয়ে দিবেন
const soldPlots = {
    "1": { logo: "https://via.placeholder.com/100", link: "https://facebook.com/kawsar" },
    "150": { logo: "https://via.placeholder.com/100", link: "https://digitalfriday.com" }
};

// --- ম্যাপ ড্রয়িং ফাংশন ---
function drawMap() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    let soldCount = 0;

    for (let i = 1; i <= totalPlots; i++) {
        const x = ((i - 1) % columns) * cellSize;
        const y = Math.floor((i - 1) / columns) * cellSize;

        if (soldPlots[i]) {
            // বিক্রি হওয়া প্লট (Logo দেখানো হবে)
            const img = new Image();
            img.src = soldPlots[i].logo;
            ctx.drawImage(img, x, y, cellSize, cellSize);
            soldCount++;
        } else {
            // খালি প্লট (বর্ডার এবং নাম্বার)
            ctx.strokeStyle = "#ccc";
            ctx.strokeRect(x, y, cellSize, cellSize);
            ctx.fillStyle = "#f9f9f9";
            ctx.fillRect(x + 1, y + 1, cellSize - 2, cellSize - 2);
            
            ctx.fillStyle = "#888";
            ctx.font = "20px Arial";
            ctx.textAlign = "center";
            ctx.fillText(i, x + cellSize / 2, y + cellSize / 2 + 7);
        }
    }

    // নির্ভুল কাউন্টিং আপডেট
    document.getElementById('soldCount').innerText = soldCount;
    document.getElementById('availCount').innerText = totalPlots - soldCount;
}

// --- স্মার্ট সার্চ এবং হাইলাইট লজিক ---
window.findAndMarkPlot = function(id) {
    if (id < 1 || id > totalPlots) return;

    const x = ((id - 1) % columns) * cellSize;
    const y = Math.floor((id - 1) / columns) * cellSize;

    // ১. মার্কার সেট করা
    marker.style.width = cellSize + "px";
    marker.style.height = cellSize + "px";
    marker.style.left = x + "px";
    marker.style.top = y + "px";
    marker.style.display = "block";

    // ২. কাস্টমারের চোখে পড়ার জন্য অটো স্ক্রল (Smooth Scroll)
    const container = document.getElementById('cWrapper');
    const scrollX = x - (window.innerWidth / 2) + (cellSize / 2);
    const scrollY = y - (window.innerHeight / 2) + (cellSize / 2);

    window.scrollTo({
        top: container.offsetTop + scrollY,
        left: scrollX,
        behavior: 'smooth'
    });
};

// ক্যানভাসে ক্লিক করলে লিংকে নিয়ে যাওয়া
canvas.addEventListener('click', function(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    const x = (e.clientX - rect.left) * scaleX;
    const y = (e.clientY - rect.top) * scaleY;

    const col = Math.floor(x / cellSize);
    const row = Math.floor(y / cellSize);
    const id = (row * columns) + col + 1;

    if (soldPlots[id]) {
        window.open(soldPlots[id].link, '_blank');
    } else {
        window.location.href = "order.html?id=" + id;
    }
});

// শুরুতে ম্যাপটি আঁকা
drawMap();
