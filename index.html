<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE 36th JULY LEGACY | OFFICIAL</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        /* Million Dollar Homepage Style Tooltip Logic */
        #legacy-tooltip { 
            position: absolute; 
            display: none; 
            background: #FFFFE1; /* Classic Tooltip Yellow */
            color: #000; 
            padding: 2px 5px; 
            border: 1px solid #333; 
            z-index: 10000; 
            pointer-events: none; 
            font-size: 12px; 
            font-family: 'Verdana', sans-serif;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        #search-marker { position: absolute; width: 50px; height: 50px; border: 4px solid #00ff00; display: none; z-index: 1000; pointer-events: none; }
    </style>
</head>
<body>

<div id="legacy-tooltip"></div>

<div class="top-nav">
    <div style="display:flex; gap:5px;">
        <input type="number" id="phSearch" style="padding:8px; background:#000; color:#fff; border:1px solid #444;" placeholder="Search Phone Number">
        <button onclick="searchByPhone()" style="background:#ff0000; color:#fff; border:none; padding:8px 12px; cursor:pointer;"><i class="fas fa-search"></i></button>
    </div>
    <div class="pill" onclick="navigator.clipboard.writeText('01756206213'); alert('Copied!')">BKASH: 01756206213</div>
</div>

<div class="hero">
    <h1 class="shimmer-title">THE 36th JULY LEGACY</h1>
    <p style="color: #FCD535; font-weight: bold;">"৳36 is not just a price, it's your signature on the history of Bangladesh."</p>
    <div class="actions">
        <a href="order.html" class="cta-gold">RESERVE MY PLOT (৳36)</a>
        <button onclick="downloadMap()" class="cta-outline"><i class="fas fa-camera"></i> DOWNLOAD MAP</button>
    </div>
</div>

<div class="map-container">
    <div style="position:relative; width:4000px;">
        <div id="search-marker"></div>
        <canvas id="mainCanvas"></canvas>
    </div>
</div>

<footer style="background: #0B0E11; color: #848e9c; padding: 30px; font-size: 13px; border-top: 1px solid #333; text-align: center;">
    <p style="color: #FCD535; font-weight: bold;">THE 36th JULY LEGACY © 2026 KAWSAR AHMED. All rights reserved.</p>
    <p>I am not responsible for the content of external sites. Images featured on homepage are © of their respective owners.</p>
</footer>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyCAdnfu2R82xbC7H85n_9mvQBE58X3TjbA",
        databaseURL: "https://the-5k-elite-legacy-default-rtdb.firebaseio.com" 
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database(), cv = document.getElementById('mainCanvas'), ctx = cv.getContext('2d');
    const bSize = 50, cols = 80; cv.width = cols * bSize; cv.height = 800 * bSize;
    let pixels = {};

    db.ref('pixels').on('value', s => {
        pixels = s.val() || {};
        ctx.fillStyle = "#ffffff"; ctx.fillRect(0,0,cv.width,cv.height);
        Object.values(pixels).forEach(p => {
            const id = parseInt(p.plotID)-1, x = (id%cols)*bSize, y = Math.floor(id/cols)*bSize;
            let img = new Image(); img.crossOrigin="anonymous"; img.src=p.imageUrl;
            img.onload = () => ctx.drawImage(img, x, y, bSize, bSize);
        });
    });

    // হোভার লজিক: ছবির ওপর মাউস নিলে নাম শো করবে (Million Dollar Homepage Style)
    window.addEventListener('mousemove', (e) => {
        const rect = cv.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;

        if (mouseX >= 0 && mouseY >= 0 && mouseX <= rect.width && mouseY <= rect.height) {
            const canvasX = mouseX / (rect.width / cv.width) * cv.width;
            const canvasY = mouseY / (rect.height / cv.height) * cv.height;
            
            let found = false;
            Object.values(pixels).forEach(p => {
                const id = parseInt(p.plotID)-1, px = (id%cols)*bSize, py = Math.floor(id/cols)*bSize;
                if(canvasX >= px && canvasX <= px+bSize && canvasY >= py && canvasY <= py+bSize) {
                    const tt = document.getElementById('legacy-tooltip');
                    tt.style.display = 'block';
                    tt.style.left = (e.pageX + 12) + 'px';
                    tt.style.top = (e.pageY + 12) + 'px';
                    tt.innerText = p.name; // এখানে কাস্টমারের ইউজারনেম শো হবে
                    cv.style.cursor = 'pointer';
                    found = true;
                }
            });
            if(!found) {
                document.getElementById('legacy-tooltip').style.display = 'none';
                cv.style.cursor = 'default';
            }
        } else {
            document.getElementById('legacy-tooltip').style.display = 'none';
        }
    });

    // ক্লিক করলে নতুন ড্যাশবোর্ড ট্যাব ওপেন হবে
    cv.addEventListener('click', (e) => {
        const rect = cv.getBoundingClientRect();
        const canvasX = (e.clientX - rect.left) / (rect.width / cv.width) * cv.width;
        const canvasY = (e.clientY - rect.top) / (rect.height / cv.height) * cv.height;
        Object.values(pixels).forEach(p => {
            const id = parseInt(p.plotID)-1, px = (id%cols)*bSize, py = Math.floor(id/cols)*bSize;
            if(canvasX >= px && canvasX <= px+bSize && canvasY >= py && canvasY <= py+bSize) {
                if(p.link && p.link !== "#") window.open(p.link, '_blank');
            }
        });
    });

    function searchByPhone() {
        const ph = document.getElementById('phSearch').value;
        const found = Object.values(pixels).find(p => p.phone === ph);
        if(found) {
            const id = found.plotID-1, x = (id%cols)*bSize, y = Math.floor(id/cols)*bSize;
            const m = document.getElementById('search-marker');
            m.style.display="block"; m.style.left=x+"px"; m.style.top=y+"px";
            m.scrollIntoView({behavior:'smooth', block:'center'});
        } else { alert("Not Found!"); }
    }

    function downloadMap() {
        const link = document.createElement('a');
        link.download = 'july-legacy.png';
        link.href = cv.toDataURL("image/png");
        link.click();
    }
</script>
</body>
</html>
